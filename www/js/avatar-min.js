window.Avatar=function(){var a={},D=180/Math.PI,W=Math.PI/180,E=/iphone|ipod|ipad|android|mobile/i.test(navigator.userAgent),u=function(c){c=0>c?360+c:c;return Math.abs(360<c?0:c)},N=function(c,a){var b=Object.keys(c);return a||b.length?b[1<b.length?Math.floor(Math.random()*(a&&a<b.length?a:b.length)):0]:null},q=function(c,a){(c="string"===typeof c?document.querySelector(c):c)&&c.classList[a?"add":"remove"]("active")},F=function(c,a){var b=document.createElement("DIV");b.className="a-notification";
b.innerHTML="<p>"+c+"</p>";(a||document.body).appendChild(b);window.setTimeout(function(){b.classList.add("active")},100);window.setTimeout(function(){(a||document.body).removeChild(b)},5E3)},y=!0;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){y={passive:!0}}}))}catch(c){}var R=function(){var c=this;c.is=!!window.localStorage||!1;c.save=function(a,b,e){if(!c.is)return!1;try{b||e?localStorage.setItem(a,JSON.stringify(b)):localStorage.removeItem(a)}catch(f){}return c};
c.load=function(a){if(!c.is)return null;if(a=localStorage.getItem(a))try{return JSON.parse(a)}catch(b){}};c["delete"]=function(a){if(!c.is)return null;localStorage.removeItem(a);return c};c.clear=function(a){if(!c.is)return null;a?a.forEach(a,function(a){c["delete"](a)}):localStorage.clear();return c};c.list=function(){var a,b=[];if(!c.is)return b;for(a=0;a<localStorage.length;a++)b.push(localStorage.key(a));return b};return c}.call({}),S=function(){var a={},d=null,b="",e=null,f=null,h=360,k=1,m=
{},t="",r=null,p=null,g="",l=null,n=function(){a.forOptions(function(a){a.element.parentElement.removeChild(a.element)});m={};k=1;f=e=null;h=360};a.init=function(e){b=e.cssClass||"";r=e.onActive;p=e.onSet;g=e.cssPreffix;d=document.querySelector(e.selector);e.audio&&(l=document.createElement("audio"),l.src=e.audio);if(!d)return 0;d.classList.add(g+"options-holder");d.addEventListener(E?"touchstart":"mousedown",function(b){if(b.target.parentElement==d&&"undefined"!=typeof b.target.dataset.angle)return a.currentAngle=
b.target.dataset.angle,b.target.classList.add("tap"),window.setTimeout(function(){b.target.classList.remove("tap")},500),b.stopPropagation(),!1},y);e.list&&e.list.length&&a.setOptions(e.list||[]);return a};a.forOptions=function(b){if("function"==typeof b){for(var d in m)if(b(m[d]))return;return a}};a.setOptions=function(g,e){var f=JSON.stringify(g),I=(void 0!=e?e:h)||360;if(t==f&&h==I)return a;n();t=f;h=I;k=u(h/g.length);f=0;for(I=g.length;f<I;f++){var l=a.snapAngle*f,r=g[f],q=void 0,w=document.createElement("LI"),
q=Math.round(l/a.snapAngle);w.dataset.angle=l;w.dataset.position=q;w.dataset.value=r;w.className=["option",b].join(" ");w.style.height="0.395em";w.style.transform=w.style.webkitTransform=w.style.msTransform="rotateZ("+l+"deg)";q={angle:l,position:q,value:r,element:w};m[l]=q;d.insertBefore(w,d.firstChild)}"function"===typeof p&&p.call(a);return a};a.tick=function(){l&&(l.pause(),window.setTimeout(function(){l.paused&&l.play()},150));return a};a.rotate=function(b){d.style.transform=d.style.webkitTransform=
d.style.msTransform="rotateZ("+b+"deg)";return a};Object.defineProperty(a,"count",{get:function(){return Object.keys(m).length}});Object.defineProperty(a,"snapAngle",{get:function(){return k||1}});Object.defineProperty(a,"currentOption",{get:function(){return m[f]||null}});Object.defineProperty(a,"currentAngle",{get:function(){return f||0},set:function(b){b=u(b);b!==f&&(e=Math.round(b/a.snapAngle),b=a.currentPosition*a.snapAngle,f!==b&&(f=b,a.forOptions(function(a){q(a.element,!1)}),a.currentOption&&
(q(a.currentOption.element,!0),"function"===typeof r&&r.call(a,a.currentOption),a.tick())))}});Object.defineProperty(a,"currentPosition",{get:function(){return e||0},set:function(b){b===e||360<a.snapAngle*b||0>a.snapAngle*b||(a.currentAngle=a.snapAngle*b)}});return a},J=null,z=null,O={gender:"female",race:["european"],hair:["alena","#000000"],eyebrows:["alena","#000000"],eyes:["alena"],clothes:["3","#ff35b1"],mouth:["alena"],ears:["2","european"],nose:["alena","european"],face:["1","european"]},K=
null,C=null,G=S(),A=S(),P=function(){var a={},d=null,b=null,e=null,f=null,h=null,k=0,m=null,t=null,r=1,p=.395/24,g=null,l="",n=function(d){b.style.transform=b.style.webkitTransform=b.style.msTransform="rotateZ("+d+"deg)";"function"===typeof h&&h.call(a,d);return d},q=function(a){g||(a=d.parentElement.getBoundingClientRect(),g={y1:a.top+a.height/2,y2:a.top+a.height},g.x1=g.x2=a.left+a.width/2,b.classList.add("tap"))},v=function(b){if(g){g.moved=!0;var d,e;e=b.touches&&b.touches.length?b.touches[0]:
b;g.x2=e.clientX;g.y2=e.clientY;e=n(u(Math.atan2(g.x2-g.x1,g.y2-g.y1)*D*-1));d=a.snapAngle;d=u(d?Math.round(e/d)*d:e);Math.sqrt(Math.pow(k,2)+Math.pow(k,2)-2*k*k*Math.cos((d-e)*W))<p&&(a.currentAngle=d);b.stopPropagation();return!1}},x=function(d){b.classList.remove("tap");g&&g.moved&&(a.currentAngle=u(Math.atan2(g.x2-g.x1,g.y2-g.y1)*D*-1));g=null};a.init=function(g){r=g.snapAngle||1;e=g.onSnap;h=g.onRotate;f=g.onRollback;l=g.cssPreffix;d=document.querySelector(g.selector);if(!d)return!1;d.classList.add(l+
"cursor-holder");k=.395;b=document.createElement("LI");b.className="cursor";b.style.height=k+"em";b.addEventListener(E?"touchstart":"mousedown",q,y);document.addEventListener(E?"touchmove":"mousemove",v,y);document.addEventListener(E?"touchend":"mouseup",x,!0);d.appendChild(b);"undefined"!=typeof g.currentPosition?a.currentPosition=g.currentPosition:a.currentAngle=g.currentAngle||0;return a};Object.defineProperty(a,"snapAngle",{get:function(){return r||1},set:function(a){a=u(a);a!=r&&(r=a)}});Object.defineProperty(a,
"currentPosition",{get:function(){return m||0},set:function(b){b===m||360<a.snapAngle*b||0>a.snapAngle*b||(a.currentAngle=a.snapAngle*b)}});Object.defineProperty(a,"currentAngle",{get:function(){return t||0},set:function(b){b=u(b);b!==t&&(m=Math.round(b/a.snapAngle),b=m*a.snapAngle,n(b),t!==b?"function"===typeof e&&e.call(a,b,m):"function"===typeof f&&f.call(a,b,m),t=b)}});return a}(),p=null,x="the-avatar-generator",v="img/",L=v+"assets/",T=v+"empty.png",U=v+"bg.png",n=null,B=null,X=function(c,d){if(!a.data)return[];
for(var b in a.dependentCategories)if(d==b)return M(c,a.dependentCategories[b][0]);b=a.data.gender[c][d]||[];return"object"!=typeof b?[]:Object.keys(b)},M=function(c,d,b,e){if(!a.data||!a.data.gender[c][d])return[];b=b||Object.keys(a.data.gender[c][d])[0];var f=[];c=a.data.gender[c][d][b]||[];if("object"!=typeof c)return f;for(var h in c)e?"#"==h.charAt(0)&&f.push(h):f.push(h);return f},V=function(a){if(a&&!a.disabled&&!a.classList.contains("active")&&a.classList.contains("a-button")){if(/.*(group\d+).*/.test(a.className)){var d;
d=a.className.replace(/.*(group\d+).*/g,"$1");var b=document.body.querySelectorAll(".a-button."+d),e=b.length;for(d=0;d<e;d++)q(b[d],!1)}else window.setTimeout(function(){q(a,!1)},300);q(a,!0)}},H=function(){var c,d=0,b=".a-interface".replace(/^[\.#]/,""),e=new RegExp(b+"-(hair|eyebrows|eyes|mouth|mustache|beard|nose|ears|race|clothes|background|accessories)");G.setOptions(a.schema?X(a.schema.gender,a.category):[]).forOptions(function(b){if(a.schema[a.category]){if(b.value==a.schema[a.category][0])return d=
b.angle,!0}else if("none"==b.value)return d=b.angle,!0});P.snapAngle=G.snapAngle;G.currentAngle=d;V(p.querySelector(".a-interface .a-interface-"+a.category));c=p.querySelector(".a-interface-category");c.className=c.className.replace(e,"");c.classList.add(b+"-"+a.category);q(".a-interface",!1)},Q=function(){var c,d;V(p.querySelector(".a-interface-"+a.schema.gender));for(c in a.uniqueCategories)a.uniqueCategories[c].forEach(function(b){if(d=p.querySelector(".a-interface-"+b))d.disabled=c!=a.schema.gender})};
a.categories=[];a.allCategories={};a.uniqueCategories={};a.dependentCategories={race:["face","nose","ears"]};a.skipRenderFor=["race","gender"];Object.defineProperty(a,"data",{get:function(){return J},set:function(c){J=c;c=Object.keys(J.gender);a.allCategories=c.reduce(function(a,b,d){a[b]=Object.keys(J.gender[b]);return a},{});a.uniqueCategories={};a.categories=[];for(var d in a.allCategories){a.uniqueCategories[d]=[];for(var b,e=0;e<a.allCategories[d].length;e++){c=!1;b=a.allCategories[d][e];0>a.categories.indexOf(b)&&
(e<a.categories.length?a.categories.splice(e,0,b):a.categories.push(b));for(var f in a.allCategories)if(d!=f&&0>a.allCategories[f].indexOf(b)){c=!0;break}c&&a.uniqueCategories[d].push(b)}}a.categories.reverse();O=O||a.randomSchema(!0,1)}});Object.defineProperty(a,"schema",{get:function(){return z},set:function(c){var d,b=JSON.stringify(c);b!=K&&(d=a.schemaToAssets(c))&&(K=b,z=JSON.parse(K),a.categories.forEach(function(a){var b=p.querySelector(".a-editor-"+a);b&&(b.style.backgroundImage=["url(",d[a]?
L+d[a]:T,")"].join(""))}),0>a.allCategories[z.gender].indexOf(C)&&0>Object.keys(a.dependentCategories).indexOf(C)&&(C=a.allCategories[z.gender][0],H()),p&&(c=document.createEvent("Events"),c.initEvent("onchange",!0,!0),c.avatar=a,p.dispatchEvent(c)))}});Object.defineProperty(a,"gender",{get:function(){return z.gender},set:function(c){if(c!=z.gender){var d=JSON.parse(K);d.gender=c;a.schema=d;Q();H()}}});Object.defineProperty(a,"category",{get:function(){return C},set:function(c){c==C||0>a.allCategories[z.gender].indexOf(c)&&
0>Object.keys(a.dependentCategories).indexOf(c)||(C=c,H())}});a.randomSchema=function(c,d){var b={},e={},f=function(a,b,c){var l=N(b,d);if(!l)return a;c&&a.length==c.keyIndex&&(e[c.dependet]?l=e[c.dependet]:e[c.dependet]=l);a.push(l);return"object"==typeof b[l]?f(a,b[l],c):a},h=function(c,e){var g,l=a.data.gender[b.gender];l[c]?(g=N(l[c],d))&&(b[c]="object"==typeof l[c][g]?f([g],l[c][g],e):[g]):b[c]=["none"]};b.gender=N(a.data.gender,d);for(var k=0,m;k<a.categories.length;k++){m=!1;for(var t in a.dependentCategories)if(0<=
a.dependentCategories[t].indexOf(a.categories[k])){h(a.categories[k],{keyIndex:1,dependet:t});m=!0;break}m||h(a.categories[k])}for(t in a.dependentCategories)b[t]=e[t];c||(a.schema=b,Q(),H());return b};a.schemaToAssets=function(c){var d,b,e,f={},h=a.data.gender[c.gender];if(!h)return!1;for(b in c)if(!(0<=a.skipRenderFor.indexOf(b))&&(d=h[b])){for(var k=0;k<c[b].length;k++)if(e=c[b][k],d[e]||""==d[e])d=d[e];else if(d&&"object"==typeof d)d=d[Object.keys(d)[0]];else if("string"!=typeof d||void 0==d)return!1;
"object"==typeof d&&(d=d[[Object.keys(d)[0]]]);if("string"!=typeof d)return!1;for(var m in a.dependentCategories)e=M(c.gender,a.dependentCategories[m][0]),e=new RegExp("\\b"+e.join("|")+"\\b"),d=d.replace(e,c[m]);f[b]=d}return f};a.setSchemaProperty=function(c,d){var b=JSON.parse(JSON.stringify(a.schema)),e;for(e in a.dependentCategories)if(c==e){var f,h=M(b.gender,a.dependentCategories[e][0]);for(f in b)for(e=0;e<b[f].length;e++)0<=h.indexOf(b[f][e])&&(b[f][e]=d[0]||d);break}b[c]=d;a.schema=b};a.detectCategoryByPoint=
function(c,d,b,e,f){e=e||a.schema;var h,k=a.schemaToAssets(e);if(!k)return!1;n||(n=document.createElement("canvas"),B=n.getContext("2d"));n.width=b;n.height=b;B.clearRect(0,0,n.width,n.height);var m=function(a,e,k){var g=new Image;g.crossorigin="";g.onload=function(){h||(B.drawImage(g,0,0,b,b),50<B.getImageData(c,d,1,1).data[3]?("function"===typeof f&&f("face"===e?"race":e),h=!0):0==k&&"function"===typeof f&&f(null))};g.src=a};for(e=a.categories.length-1;0<=e&&!h;e--)k[a.categories[e]]&&"none"!=k[a.categories[e]]&&
m(L+k[a.categories[e]],a.categories[e],e)};a.drawSchema=function(c,d){c=c||a.schema;var b,e=0,f=[],h=a.schemaToAssets(c);if(h)R.save(x+" avatarSchema",c,!0);else return!1;n||(n=document.createElement("canvas"),B=n.getContext("2d"));n.width=480;n.height=480;B.clearRect(0,0,n.width,n.height);var k=function(a){var b=new Image;f.push(b);b.crossorigin="";b.onload=function(){e++;if(e>=f.length){for(var a=0;a<f.length;a++)B.drawImage(f[a],0,0);"function"===typeof d&&d(n)}};b.src=a};for(b=0;b<a.categories.length;b++)h[a.categories[b]]&&
"none"!=h[a.categories[b]]&&k(L+h[a.categories[b]]),"background"==a.categories[b]&&k(U)};a.getDataUrl=function(c){a.drawSchema(a.schema,function(a){"function"===typeof c&&c(a.toDataURL())})};a.init=function(c,d){d=d||{};x=d.id||x;p=document.querySelector(d.selector||".a-root");var b=p.querySelector(".a-interface"),e=p.querySelector(".a-download"),f=p.querySelector(".a-more"),h=p.querySelector(".a-logo"),k=p.querySelector(".a-interface-menu"),m=function(b,c){var d=0;A.setOptions(b,12*b.length);n(c||
0);a.schema[a.category]&&1<a.schema[a.category].length&&A.forOptions(function(b){if(a.schema[a.category]&&b.value==a.schema[a.category][1])return d=b.angle,!0});A.currentAngle=d},n=function(a){A.rotate(a+(180-12*Math.max(A.count-1,0)/2))},r=function(a){var b=a.currentTarget;window.setTimeout(function(){q(b,!1)},e==b?500:100)},u=E?"touchstart":"mousedown";document.addEventListener(u,function(b){if(b.target.classList.contains("a-button")){b.target.classList.add("interact");window.setTimeout(function(){b.target.classList.remove("interact")},
500);switch(b.target.dataset.action){case "hair":case "eyebrows":case "eyes":case "mouth":case "mustache":case "beard":case "nose":case "ears":case "race":case "clothes":case "background":case "accessories":a.category=b.target.dataset.action;break;case "female":case "male":a.gender=b.target.dataset.action;break;case "random":a.randomSchema();break;case "category":q(".a-interface",!0);break;case "download":return;case "save":a.drawSchema(a.schema,function(b){var c=b.toDataURL();b=p.querySelector(".a-interface-download");
window.cordova&&window.cordova.base64ToGallery?(b.href="javascript:void(0)",b.removeAttribute("download"),b.onclick=function(){a.saveToAlbum(c)}):/edge|msie|trident/i.test(window.navigator.userAgent)?(b.href="javascript:void(0)",b.onclick=function(){window.open("","_blank").document.writeln('<img src="'+c+'" />')}):(b.href=c,b.download="avatar.png",b.target="_blank",b.onclick=function(){F("The download will start within second.",p)});window.setTimeout(function(){q(e,!0)},100)})}if("A"==b.target.nodeName&&
b.target.href)if(window.cordova)window.open(b.target.href,"_system");else return;b.stopPropagation();return!1}},y);b.addEventListener(u,r,y);e.addEventListener(u,r,y);f.addEventListener("click",r,!0);p.id=x;d.showLogo&&(h.style.display="block");d.showMenu&&(k.style.display="block");d.imgSrc&&(v=d.imgSrc||"img/",L=v+"assets/",T=v+"empty.png",U=v+"bg.png");d.autoDetectCategory&&p.querySelector(".a-editor > ol").addEventListener("click",function(b){a.detectCategoryByPoint(b.offsetX,b.offsetY,b.target.clientWidth,
a.schema,function(b){b&&(a.category=b)})});A.init({onActive:function(b){b&&a.setSchemaProperty(a.category,[a.schema[a.category][0],b.value])},onSet:function(){A.forOptions(function(a){a.element.style.color=a.value})},selector:"#"+x+" .a-editor-colors",cssClass:"color",cssPreffix:"a-",audio:v+"option.wav"});G.init({onActive:function(b){P.currentAngle=b.angle;var c;c=a.schema?M(a.schema.gender,a.category,b.value,!0):[];m(c,b.angle);b=[b.value];a.schema[a.category]&&"string"!=typeof a.schema[a.category]&&
1<a.schema[a.category].length&&b.push(a.schema[a.category][1]);a.setSchemaProperty(a.category,b)},selector:"#"+x+" .a-editor-options",cssPreffix:"a-",audio:v+"option.wav"});P.init({onSnap:function(a,b){G.currentAngle=a},onRollback:function(a,b){n(a)},onRotate:function(a){n(a)},selector:"#"+x+" .a-editor-options",cssPreffix:"a-"});a.data=c;a.schema=d.schema||R.load(x+" avatarSchema")||O;Q();H();return a};a.saveToAlbum=function(a){if(window.cordova&&window.cordova.base64ToGallery){var d=function(){window.cordova.base64ToGallery(a,
"avatar_",function(){F("Avatar has been saved into album.")},function(){F("Save. Something went wrong.")})};/android/i.test(navigator.userAgent)&&window.cordova.plugins&&window.cordova.plugins.diagnostic?window.cordova.plugins.diagnostic.requestRuntimePermission(function(a){a?d():F("Permission not granted for the requested operation.")},function(){F("Permission. Something went wrong.")},window.cordova.plugins.diagnostic.runtimePermission.WRITE_EXTERNAL_STORAGE):d()}};a.more=function(){q(".a-more",
!0)};return a};Avatar.contactMe=function(a){var D=["oleksiy.nesterov+",[].join.apply(["avatar","gmail"],["@"]),".com"].join("");a&&!window.cordova?a.innerHTML=D:window.open("mailto:"+D,window.cordova?"_system":"_blank")};Avatar().init(window.AvatarData,{showLogo:!0,showMenu:!0,autoDetectCategory:!0});
