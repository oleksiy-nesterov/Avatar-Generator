window.Avatar=function(){var e={},t=180/Math.PI,n=Math.PI/180,r=/iphone|ipod|ipad|android|mobile/i.test(navigator.userAgent),o=function(e){return e=e<0?360+e:e,Math.abs(e>360?0:e)},a=function(e,t){var n=Object.keys(e);return t||n.length?n[n.length>1?Math.floor(Math.random()*(t&&t<n.length?t:n.length)):0]:null},i=function(e,t){(e="string"==typeof e?document.querySelector(e):e)&&e.classList[t?"add":"remove"]("active")},c=function(e,t){var n=document.createElement("DIV");n.className="a-notification",n.innerHTML="<p>"+e+"</p>",(t||document.body).appendChild(n),window.setTimeout(function(){n.classList.add("active")},100),window.setTimeout(function(){(t||document.body).removeChild(n)},5e3)},s=!0;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){s={passive:!0}}}))}catch(e){}var u=function(){var e=this;return e.is=Boolean(window.localStorage)||!1,e.save=function(t,n,r){if(!e.is)return!1;try{n||r?localStorage.setItem(t,JSON.stringify(n)):localStorage.removeItem(t)}catch(e){}return e},e.load=function(t){if(!e.is)return null;var n=localStorage.getItem(t);if(n)try{return JSON.parse(n)}catch(e){return}},e.delete=function(t){return e.is?(localStorage.removeItem(t),e):null},e.clear=function(t){return e.is?(t?t.forEach(t,function(t){e.delete(t)}):localStorage.clear(),e):null},e.list=function(){var t,n=[];if(!e.is)return n;for(t=0;t<localStorage.length;t++)n.push(localStorage.key(t));return n},e}.call({}),l=function(){var e={},t=null,n="",a=null,c=null,u=360,l=1,d={},f="",g=null,m=null,p="",h=null,v=function(){e.forOptions(function(e){e.element.parentElement.removeChild(e.element)}),d={},l=1,a=null,c=null,u=360},y=function(r,o){var a,i=document.createElement("LI"),c=Math.round(r/e.snapAngle);return i.dataset.angle=r,i.dataset.position=c,i.dataset.value=o,i.className=["option",n].join(" "),i.style.height="0.395em",i.style.transform=i.style.webkitTransform=i.style.msTransform="rotateZ("+r+"deg)",a={angle:r,position:c,value:o,element:i},d[r]=a,t.insertBefore(i,t.firstChild),a};return e.init=function(o){if(n=o.cssClass||"",g=o.onActive,m=o.onSet,p=o.cssPreffix,t=document.querySelector(o.selector),o.audio&&(h=document.createElement("audio"),h.src=o.audio),!t)return 0;var a=function(n){if(n.target.parentElement==t&&void 0!==n.target.dataset.angle)return e.currentAngle=n.target.dataset.angle,n.target.classList.add("tap"),window.setTimeout(function(){n.target.classList.remove("tap")},500),n.stopPropagation(),!1};return t.classList.add(p+"options-holder"),t.addEventListener(r?"touchstart":"mousedown",a,s),o.list&&o.list.length&&e.setOptions(o.list||[]),e},e.forOptions=function(t){if("function"==typeof t){for(var n in d)if(t(d[n]))return;return e}},e.setOptions=function(t,n){var r=JSON.stringify(t),a=(void 0!=n?n:u)||360;if(f==r&&u==a)return e;v(),f=r,u=a,l=o(u/t.length);for(var i=0,c=t.length;i<c;i++)y(e.snapAngle*i,t[i]);return"function"==typeof m&&m.call(e),e},e.tick=function(){return h&&(h.pause(),window.setTimeout(function(){h.paused&&h.play()},150)),e},e.rotate=function(n){return t.style.transform=t.style.webkitTransform=t.style.msTransform="rotateZ("+n+"deg)",e},Object.defineProperty(e,"count",{get:function(){return Object.keys(d).length}}),Object.defineProperty(e,"snapAngle",{get:function(){return l||1}}),Object.defineProperty(e,"currentOption",{get:function(){return d[c]||null}}),Object.defineProperty(e,"currentAngle",{get:function(){return c||0},set:function(t){if((t=o(t))!==c){a=Math.round(t/e.snapAngle);var n=e.currentPosition*e.snapAngle;c!==n&&(c=n,e.forOptions(function(e){i(e.element,!1)}),e.currentOption&&(i(e.currentOption.element,!0),"function"==typeof g&&g.call(e,e.currentOption),e.tick()))}}}),Object.defineProperty(e,"currentPosition",{get:function(){return a||0},set:function(t){t===a||e.snapAngle*t>360||e.snapAngle*t<0||(e.currentAngle=e.snapAngle*t)}}),e},d=null,f=null,g={gender:"female",race:["european"],hair:["alena","#000000"],eyebrows:["alena","#000000"],eyes:["alena"],clothes:["3","#ff35b1"],mouth:["alena"],ears:["2","european"],nose:["alena","european"],face:["1","european"],mustache:["none"],beard:["none"]},m=null,p=null,h=l(),v=l(),y=function(){var e={},a=null,i=null,c=null,u=null,l=null,d=0,f=null,g=null,m=1,p=null,h="",v=function(e,n,r,a){return o(Math.atan2(r-e,a-n)*t*-1)},y=function(e,t){return o(t?Math.round(e/t)*t:e)},w=function(e,t,r){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)-2*e*t*Math.cos(r*n))},b=function(t){return i.style.transform=i.style.webkitTransform=i.style.msTransform="rotateZ("+t+"deg)","function"==typeof l&&l.call(e,t),t},O=function(e){return e.touches&&e.touches.length?e.touches[0]:e},A=function(e){if(!p){var t=a.parentElement.getBoundingClientRect();p={y1:t.top+t.height/2,y2:t.top+t.height},p.x1=p.x2=t.left+t.width/2,i.classList.add("tap")}},S=function(t){if(p){p.moved=!0;var n,r,o,a=O(t);return p.x2=a.clientX,p.y2=a.clientY,o=b(v(p.x1,p.y1,p.x2,p.y2)),n=y(o,e.snapAngle),r=w(d,d,n-o),r<.395/24&&(e.currentAngle=n),t.stopPropagation(),!1}},k=function(t){if(i.classList.remove("tap"),!p||!p.moved)return void(p=null);e.currentAngle=v(p.x1,p.y1,p.x2,p.y2),p=null};return e.init=function(t){return m=t.snapAngle||1,c=t.onSnap,l=t.onRotate,u=t.onRollback,h=t.cssPreffix,!!(a=document.querySelector(t.selector))&&(a.classList.add(h+"cursor-holder"),d=.395,i=document.createElement("LI"),i.className="cursor",i.style.height=d+"em",i.addEventListener(r?"touchstart":"mousedown",A,s),document.addEventListener(r?"touchmove":"mousemove",S,s),document.addEventListener(r?"touchend":"mouseup",k,!0),a.appendChild(i),void 0!==t.currentPosition?e.currentPosition=t.currentPosition:e.currentAngle=t.currentAngle||0,e)},Object.defineProperty(e,"snapAngle",{get:function(){return m||1},set:function(e){(e=o(e))!=m&&(m=e)}}),Object.defineProperty(e,"currentPosition",{get:function(){return f||0},set:function(t){t===f||e.snapAngle*t>360||e.snapAngle*t<0||(e.currentAngle=e.snapAngle*t)}}),Object.defineProperty(e,"currentAngle",{get:function(){return g||0},set:function(t){if((t=o(t))!==g){f=Math.round(t/e.snapAngle);var n=f*e.snapAngle;b(n),g!==n?"function"==typeof c&&c.call(e,n,f):"function"==typeof u&&u.call(e,n,f),g=n}}}),e}(),w=null,b="the-avatar-generator",O=".a-interface",A="img/",S=A+"assets/",k=A+"empty.png",C=A+"bg.png",P=null,j=null,L=function(e){return"#"+b+" "+e},E=function(t,n){if(!e.data)return[];for(var r in e.dependentCategories)if(n==r)return x(t,e.dependentCategories[r][0]);var o=e.data.gender[t][n]||[];return"object"!=typeof o?[]:Object.keys(o)},T=function(t){return e.schema?E(e.schema.gender,t):[]},x=function(t,n,r,o){if(!e.data||!e.data.gender[t][n])return[];r=r||Object.keys(e.data.gender[t][n])[0];var a=[],i=e.data.gender[t][n][r]||[];if("object"!=typeof i)return a;for(var c in i)o?"#"==c.charAt(0)&&a.push(c):a.push(c);return a},q=function(t,n){return e.schema?x(e.schema.gender,t,n,!0):[]},M=function(e){if(e&&!e.disabled&&!e.classList.contains("active")&&e.classList.contains("a-button")){if(/.*(group\d+).*/.test(e.className)){var t,n=e.className.replace(/.*(group\d+).*/g,"$1"),r=document.body.querySelectorAll(".a-button."+n),o=r.length;for(t=0;t<o;t++)i(r[t],!1)}else window.setTimeout(function(){i(e,!1)},300);i(e,!0)}},I=function(){var t,n=0,r=O.replace(/^[\.#]/,""),o=new RegExp(r+"-(hair|eyebrows|eyes|mouth|mustache|beard|nose|ears|race|clothes|background|accessories)");h.setOptions(T(e.category)).forOptions(function(t){if(e.schema[e.category]){if(t.value==e.schema[e.category][0])return n=t.angle,!0}else if("none"==t.value)return n=t.angle,!0}),y.snapAngle=h.snapAngle,h.currentAngle=n,M(w.querySelector(O+" "+O+"-"+e.category)),t=w.querySelector(".a-interface-category"),t.className=t.className.replace(o,""),t.classList.add(r+"-"+e.category),i(O,!1)},N=function(){var t,n;M(w.querySelector(O+"-"+e.schema.gender));for(t in e.uniqueCategories)e.uniqueCategories[t].forEach(function(r){(n=w.querySelector(O+"-"+r))&&(n.disabled=t!=e.schema.gender)})};return e.categories=[],e.allCategories={},e.uniqueCategories={},e.dependentCategories={race:["face","nose","ears"]},e.skipRenderFor=["race","gender"],Object.defineProperty(e,"data",{get:function(){return d},set:function(t){d=t;var n=Object.keys(d.gender);e.allCategories=n.reduce(function(e,t,n){return e[t]=Object.keys(d.gender[t]),e},{}),e.uniqueCategories={},e.categories=[];for(var r in e.allCategories){e.uniqueCategories[r]=[];for(var o,a,i=0;i<e.allCategories[r].length;i++){o=!1,a=e.allCategories[r][i],e.categories.indexOf(a)<0&&(i<e.categories.length?e.categories.splice(i,0,a):e.categories.push(a));for(var c in e.allCategories)if(r!=c&&e.allCategories[c].indexOf(a)<0){o=!0;break}o&&e.uniqueCategories[r].push(a)}}e.categories.reverse(),g=g||e.randomSchema(!0,1)}}),Object.defineProperty(e,"schema",{get:function(){return f},set:function(t){var n,r=JSON.stringify(t);if(r!=m&&(n=e.schemaToAssets(t))&&(m=r,f=JSON.parse(m),e.categories.forEach(function(e){var t=w.querySelector(".a-editor-"+e);t&&(t.style.backgroundImage=["url(",n[e]?S+n[e]:k,")"].join(""))}),e.allCategories[f.gender].indexOf(p)<0&&Object.keys(e.dependentCategories).indexOf(p)<0&&(p=e.allCategories[f.gender][0],I()),w)){var o=document.createEvent("Events");o.initEvent("onchange",!0,!0),o.avatar=e,w.dispatchEvent(o)}}}),Object.defineProperty(e,"gender",{get:function(){return f.gender},set:function(t){if(t!=f.gender){var n=JSON.parse(m);n.gender=t,e.schema=n,N(),I()}}}),Object.defineProperty(e,"category",{get:function(){return p},set:function(t){t==p||e.allCategories[f.gender].indexOf(t)<0&&Object.keys(e.dependentCategories).indexOf(t)<0||(p=t,I())}}),e.randomSchema=function(t,n){var r={},o={},i=function(e,t,r){var c=a(t,n);return c?(r&&e.length==r.keyIndex&&(o[r.dependet]?c=o[r.dependet]:o[r.dependet]=c),e.push(c),"object"==typeof t[c]?i(e,t[c],r):e):e},c=function(t,o){var c,s=e.data.gender[r.gender];if(s[t]){if(!(c=a(s[t],n)))return;"object"==typeof s[t][c]?r[t]=i([c],s[t][c],o):r[t]=[c]}else r[t]=["none"]};r.gender=a(e.data.gender,n);for(var s,u=0;u<e.categories.length;u++){s=!1;for(var l in e.dependentCategories)if(e.dependentCategories[l].indexOf(e.categories[u])>=0){c(e.categories[u],{keyIndex:1,dependet:l}),s=!0;break}s||c(e.categories[u])}for(var l in e.dependentCategories)r[l]=o[l];return t||(e.schema=r,N(),I()),r},e.schemaToAssets=function(t){var n,r,o,a,i={},c=e.data.gender[t.gender];if(!c)return!1;for(r in t)if(!(e.skipRenderFor.indexOf(r)>=0)&&(n=c[r])){for(var s,u=0;u<t[r].length;u++)if(s=t[r][u],n[s]||""==n[s])n=n[s];else if(n&&"object"==typeof n)n=n[Object.keys(n)[0]];else if("string"!=typeof n||void 0==n)return!1;if("object"==typeof n&&(n=n[[Object.keys(n)[0]]]),"string"!=typeof n)return!1;for(var l in e.dependentCategories)o=x(t.gender,e.dependentCategories[l][0]),a=new RegExp("\\b"+o.join("|")+"\\b"),n=n.replace(a,t[l]);i[r]=n}return i},e.setSchemaProperty=function(t,n){var r=JSON.parse(JSON.stringify(e.schema));for(var o in e.dependentCategories)if(t==o){var a,i,c=x(r.gender,e.dependentCategories[o][0]);for(i in r)for(var a=0;a<r[i].length;a++)c.indexOf(r[i][a])>=0&&(r[i][a]=n[0]||n);break}r[t]=n,e.schema=r},e.detectCategoryByPoint=function(t,n,r,o,a){o=o||e.schema;var i,c,s=0,u=[],l=e.schemaToAssets(o);if(!l)return!1;P||(P=document.createElement("canvas"),j=P.getContext("2d")),P.width=r,P.height=r,j.clearRect(0,0,P.width,P.height);for(i=e.categories.length-1;i>=0;i--){if(c)return;l[e.categories[i]]&&"none"!=l[e.categories[i]]&&function(e,o,i){var l=new Image;u.push(l),l.crossorigin="",l.onload=function(){if(s++,!c){if(j.drawImage(l,0,0,r,r),j.getImageData(t,n,1,1).data[3]>0)return"function"==typeof a&&a("face"===o?"race":o),void(c=!0);s>=u.length&&"function"==typeof a&&a("background")}},l.src=e}(S+l[e.categories[i]],e.categories[i])}},e.drawSchema=function(t,n){t=t||e.schema;var r,o=0,a=[],i=e.schemaToAssets(t);if(!i)return!1;u.save(b+" avatarSchema",t,!0),P||(P=document.createElement("canvas"),j=P.getContext("2d")),P.width=480,P.height=480,j.clearRect(0,0,P.width,P.height);var c=function(e){var t=new Image;a.push(t),t.crossorigin="",t.onload=function(){if(++o>=a.length){for(var e=0;e<a.length;e++)j.drawImage(a[e],0,0);"function"==typeof n&&n(P)}},t.src=e};for(r=0;r<e.categories.length;r++)i[e.categories[r]]&&"none"!=i[e.categories[r]]&&c(S+i[e.categories[r]]),"background"==e.categories[r]&&c(C)},e.getDataUrl=function(t){e.drawSchema(e.schema,function(e){"function"==typeof t&&t(e.toDataURL())})},e.init=function(t,n){n=n||{},b=n.id||b,w=document.querySelector(n.selector||".a-root");var o=w.querySelector(O),a=w.querySelector(".a-download"),l=w.querySelector(".a-more"),d=w.querySelector(".a-logo"),f=w.querySelector(".a-interface-menu"),m=function(t,n){var r=0,o=12*t.length;v.setOptions(t,o),p(n||0),e.schema[e.category]&&e.schema[e.category].length>1&&v.forOptions(function(t){if(e.schema[e.category]&&t.value==e.schema[e.category][1])return r=t.angle,!0}),v.currentAngle=r},p=function(e){var t=12*Math.max(v.count-1,0);v.rotate(e+(180-t/2))},P=function(t){if(t.target.classList.contains("a-button")){switch(t.target.classList.add("interact"),window.setTimeout(function(){t.target.classList.remove("interact")},500),t.target.dataset.action){case"hair":case"eyebrows":case"eyes":case"mouth":case"mustache":case"beard":case"nose":case"ears":case"race":case"clothes":case"background":case"accessories":e.category=t.target.dataset.action;break;case"female":case"male":e.gender=t.target.dataset.action;break;case"random":e.randomSchema();break;case"category":i(O,!0);break;case"download":return;case"save":e.drawSchema(e.schema,function(t){var n=t.toDataURL(),r=w.querySelector(O+"-download");window.cordova&&window.cordova.base64ToGallery?(r.href="javascript:void(0)",r.removeAttribute("download"),r.onclick=function(){e.saveToAlbum(n)}):/edge|msie|trident/i.test(window.navigator.userAgent)?(r.href="javascript:void(0)",r.onclick=function(){window.open("","_blank").document.writeln('<img src="'+n+'" />')}):(r.href=n,r.download="avatar.png",r.target="_blank",r.onclick=function(){c("The download will start within second.",w)}),window.setTimeout(function(){i(a,!0)},100)})}if("A"==t.target.nodeName&&t.target.href){if(!window.cordova)return;window.open(t.target.href,"_system")}return t.stopPropagation(),!1}},j=function(e){var t=e.currentTarget;window.setTimeout(function(){i(t,!1)},a==t?500:100)},E=r?"touchstart":"mousedown";return document.addEventListener(E,P,s),o.addEventListener(E,j,s),a.addEventListener(E,j,s),l.addEventListener("click",j,!0),w.id=b,n.showLogo&&(d.style.display="block"),n.showMenu&&(f.style.display="block"),n.imgSrc&&(A=n.imgSrc||"img/",S=A+"assets/",k=A+"empty.png",C=A+"bg.png"),n.autoDetectCategory&&w.querySelector(".a-editor > ol").addEventListener("click",function(t){e.detectCategoryByPoint(t.offsetX,t.offsetY,t.target.clientWidth,e.schema,function(t){t&&(e.category=t)})}),v.init({onActive:function(t){t&&e.setSchemaProperty(e.category,[e.schema[e.category][0],t.value])},onSet:function(){v.forOptions(function(e){e.element.style.color=e.value})},selector:L(".a-editor-colors"),cssClass:"color",cssPreffix:"a-",audio:A+"option.wav"}),h.init({onActive:function(t){y.currentAngle=t.angle,m(q(e.category,t.value),t.angle);var n=[t.value];e.schema[e.category]&&"string"!=typeof e.schema[e.category]&&e.schema[e.category].length>1&&n.push(e.schema[e.category][1]),e.setSchemaProperty(e.category,n)},selector:L(".a-editor-options"),cssPreffix:"a-",audio:A+"option.wav"}),y.init({onSnap:function(e,t){h.currentAngle=e},onRollback:function(e,t){p(e)},onRotate:function(e){p(e)},selector:L(".a-editor-options"),cssPreffix:"a-"}),e.data=t,e.schema=n.schema||u.load(b+" avatarSchema")||g,N(),I(),e},e.saveToAlbum=function(e){if(window.cordova&&window.cordova.base64ToGallery){var t=function(){window.cordova.base64ToGallery(e,"avatar_",function(){c("Avatar has been saved into album.")},function(){c("Save. Something went wrong.")})};/android/i.test(navigator.userAgent)&&window.cordova.plugins&&window.cordova.plugins.diagnostic?window.cordova.plugins.diagnostic.requestRuntimePermission(function(e){e?t():c("Permission not granted for the requested operation.")},function(){c("Permission. Something went wrong.")},window.cordova.plugins.diagnostic.runtimePermission.WRITE_EXTERNAL_STORAGE):t()}},e.more=function(){i(".a-more",!0)},e},Avatar.contactMe=function(e){var t=["oleksiy.nesterov","+",[].join.apply(["avatar","gmail"],["@"]),".com"].join("");e&&!window.cordova?e.innerHTML=t:window.open("mailto:"+t,window.cordova?"_system":"_blank")},Avatar().init(window.AvatarData,{showLogo:!0,showMenu:!0,autoDetectCategory:!0});
//# sourceMappingURL=avatar.min.js.map
