window.Avatar=function(){var e={},t=180/Math.PI,n=Math.PI/180,r=/iphone|ipod|ipad|android|mobile/i.test(navigator.userAgent),o=/iphone|ipod|ipad/i.test(navigator.userAgent),a=function(e){return e=e<0?360+e:e,Math.abs(e>360?0:e)},i=function(e,t){var n=Object.keys(e);return t||n.length?n[n.length>1?Math.floor(Math.random()*(t&&t<n.length?t:n.length)):0]:null},c=function(e,t){(e="string"==typeof e?document.querySelector(e):e)&&e.classList[t?"add":"remove"]("active")},s=function(e,t){var n=document.createElement("DIV");n.className="a-notification",n.innerHTML="<p>"+e+"</p>",(t||document.body).appendChild(n),window.setTimeout(function(){n.classList.add("active")},100),window.setTimeout(function(){(t||document.body).removeChild(n)},5e3)},u=!0;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){u={passive:!0}}}))}catch(e){}var l=function(){var e=this;return e.is=Boolean(window.localStorage)||!1,e.save=function(t,n,r){if(!e.is)return!1;try{n||r?localStorage.setItem(t,JSON.stringify(n)):localStorage.removeItem(t)}catch(e){}return e},e.load=function(t){if(!e.is)return null;var n=localStorage.getItem(t);if(n)try{return JSON.parse(n)}catch(e){return}},e.delete=function(t){return e.is?(localStorage.removeItem(t),e):null},e.clear=function(t){return e.is?(t?t.forEach(t,function(t){e.delete(t)}):localStorage.clear(),e):null},e.list=function(){var t,n=[];if(!e.is)return n;for(t=0;t<localStorage.length;t++)n.push(localStorage.key(t));return n},e}.call({}),d=function(){var e={},t=null,n="",o=null,i=null,s=360,u=1,l={},d="",f=null,g=null,p="",m=null,h=function(){e.forOptions(function(e){e.element.parentElement.removeChild(e.element)}),l={},u=1,o=null,i=null,s=360},v=function(r,o){var a,i=document.createElement("LI"),c=Math.round(r/e.snapAngle);return i.dataset.angle=r,i.dataset.position=c,i.dataset.value=o,i.className=["option",n].join(" "),i.style.height="0.395em",i.style.transform=i.style.webkitTransform=i.style.msTransform="rotateZ("+r+"deg)",a={angle:r,position:c,value:o,element:i},l[r]=a,t.insertBefore(i,t.firstChild),a};return e.init=function(o){if(n=o.cssClass||"",f=o.onActive,g=o.onSet,p=o.cssPreffix,t=document.querySelector(o.selector),o.audio&&(m=document.createElement("audio"),m.src=o.audio),!t)return 0;var a=function(n){if(n.target.parentElement==t&&void 0!==n.target.dataset.angle)return e.currentAngle=n.target.dataset.angle,n.target.classList.add("tap"),window.setTimeout(function(){n.target.classList.remove("tap")},500),n.stopPropagation(),n.preventDefault(),!1};return t.classList.add(p+"options-holder"),t.addEventListener(r?"touchstart":"mousedown",a),o.list&&o.list.length&&e.setOptions(o.list||[]),e},e.forOptions=function(t){if("function"==typeof t){for(var n in l)if(t(l[n]))return;return e}},e.setOptions=function(t,n){var r=JSON.stringify(t),o=(void 0!=n?n:s)||360;if(d==r&&s==o)return e;h(),d=r,s=o,u=a(s/t.length);for(var i=0,c=t.length;i<c;i++)v(e.snapAngle*i,t[i]);return"function"==typeof g&&g.call(e),e},e.tick=function(){return m&&(m.pause(),window.setTimeout(function(){m.paused&&m.play()},150)),e},e.rotate=function(n){return t.style.transform=t.style.webkitTransform=t.style.msTransform="rotateZ("+n+"deg)",e},Object.defineProperty(e,"count",{get:function(){return Object.keys(l).length}}),Object.defineProperty(e,"snapAngle",{get:function(){return u||1}}),Object.defineProperty(e,"currentOption",{get:function(){return l[i]||null}}),Object.defineProperty(e,"currentAngle",{get:function(){return i||0},set:function(t){if((t=a(t))!==i){o=Math.round(t/e.snapAngle);var n=e.currentPosition*e.snapAngle;i!==n&&(i=n,e.forOptions(function(e){c(e.element,!1)}),e.currentOption&&(c(e.currentOption.element,!0),"function"==typeof f&&f.call(e,e.currentOption),e.tick()))}}}),Object.defineProperty(e,"currentPosition",{get:function(){return o||0},set:function(t){t===o||e.snapAngle*t>360||e.snapAngle*t<0||(e.currentAngle=e.snapAngle*t)}}),e},f=null,g=null,p={gender:"female",race:["european"],hair:["alena","#000000"],eyebrows:["alena","#000000"],eyes:["alena"],clothes:["3","#ff35b1"],mouth:["alena"],ears:["2","european"],nose:["alena","european"],face:["1","european"],mustache:["none"],beard:["none"]},m=null,h=null,v=d(),y=d(),w=function(){var e={},o=null,i=null,c=null,s=null,l=null,d=0,f=null,g=null,p=1,m=null,h="",v=function(e,n,r,o){return a(Math.atan2(r-e,o-n)*t*-1)},y=function(e,t){return a(t?Math.round(e/t)*t:e)},w=function(e,t,r){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)-2*e*t*Math.cos(r*n))},b=function(t){return i.style.transform=i.style.webkitTransform=i.style.msTransform="rotateZ("+t+"deg)","function"==typeof l&&l.call(e,t),t},A=function(e){return e.touches&&e.touches.length?e.touches[0]:e},S=function(e){if(!m){var t=o.parentElement.getBoundingClientRect();m={y1:t.top+t.height/2,y2:t.top+t.height},m.x1=m.x2=t.left+t.width/2,i.classList.add("tap")}},O=function(t){if(m){m.moved=!0;var n,o,a,i=A(t);return m.x2=i.clientX,m.y2=i.clientY,a=b(v(m.x1,m.y1,m.x2,m.y2)),n=y(a,e.snapAngle),o=w(d,d,n-a),o<.395/24&&(e.currentAngle=n),t.stopPropagation(),!r&&t.preventDefault(),!1}},k=function(t){if(i.classList.remove("tap"),!m||!m.moved)return void(m=null);e.currentAngle=v(m.x1,m.y1,m.x2,m.y2),m=null};return e.init=function(t){return p=t.snapAngle||1,c=t.onSnap,l=t.onRotate,s=t.onRollback,h=t.cssPreffix,!!(o=document.querySelector(t.selector))&&(o.classList.add(h+"cursor-holder"),d=.395,i=document.createElement("LI"),i.className="cursor",i.style.height=d+"em",i.addEventListener(r?"touchstart":"mousedown",S,u),document.addEventListener(r?"touchmove":"mousemove",O,u),document.addEventListener(r?"touchend":"mouseup",k,!0),o.appendChild(i),void 0!==t.currentPosition?e.currentPosition=t.currentPosition:e.currentAngle=t.currentAngle||0,e)},Object.defineProperty(e,"snapAngle",{get:function(){return p||1},set:function(e){(e=a(e))!=p&&(p=e)}}),Object.defineProperty(e,"currentPosition",{get:function(){return f||0},set:function(t){t===f||e.snapAngle*t>360||e.snapAngle*t<0||(e.currentAngle=e.snapAngle*t)}}),Object.defineProperty(e,"currentAngle",{get:function(){return g||0},set:function(t){if((t=a(t))!==g){f=Math.round(t/e.snapAngle);var n=f*e.snapAngle;b(n),g!==n?"function"==typeof c&&c.call(e,n,f):"function"==typeof s&&s.call(e,n,f),g=n}}}),e}(),b=null,A="the-avatar-generator",S=".a-interface",O="img/",k=O+"assets/",C=O+"empty.png",E=O+"bg.png",P=null,T=null,j=function(e){return"#"+A+" "+e},L=function(t,n){if(!e.data)return[];for(var r in e.dependentCategories)if(n==r)return q(t,e.dependentCategories[r][0]);var o=e.data.gender[t][n]||[];return"object"!=typeof o?[]:Object.keys(o)},x=function(t){return e.schema?L(e.schema.gender,t):[]},q=function(t,n,r,o){if(!e.data||!e.data.gender[t][n])return[];r=r||Object.keys(e.data.gender[t][n])[0];var a=[],i=e.data.gender[t][n][r]||[];if("object"!=typeof i)return a;for(var c in i)o?"#"==c.charAt(0)&&a.push(c):a.push(c);return a},N=function(t,n){return e.schema?q(e.schema.gender,t,n,!0):[]},R=function(e){if(e&&!e.disabled&&!e.classList.contains("active")&&e.classList.contains("a-button")){if(/.*(group\d+).*/.test(e.className)){var t,n=e.className.replace(/.*(group\d+).*/g,"$1"),r=document.body.querySelectorAll(".a-button."+n),o=r.length;for(t=0;t<o;t++)c(r[t],!1)}else window.setTimeout(function(){c(e,!1)},300);c(e,!0)}},I=function(){var t,n=0,r=S.replace(/^[\.#]/,""),o=new RegExp(r+"-(hair|eyebrows|eyes|mouth|mustache|beard|nose|ears|race|clothes|background|accessories)");v.setOptions(x(e.category)).forOptions(function(t){if(e.schema[e.category]){if(t.value==e.schema[e.category][0])return n=t.angle,!0}else if("none"==t.value)return n=t.angle,!0}),w.snapAngle=v.snapAngle,v.currentAngle=n,R(b.querySelector(S+" "+S+"-"+e.category)),t=b.querySelector(".a-interface-category"),t.className=t.className.replace(o,""),t.classList.add(r+"-"+e.category),c(S,!1)},M=function(){var t,n;R(b.querySelector(S+"-"+e.schema.gender));for(t in e.uniqueCategories)e.uniqueCategories[t].forEach(function(r){(n=b.querySelector(S+"-"+r))&&(n.disabled=t!=e.schema.gender)})};return e.categories=[],e.allCategories={},e.uniqueCategories={},e.dependentCategories={race:["face","nose","ears"]},e.skipRenderFor=["race","gender"],Object.defineProperty(e,"data",{get:function(){return f},set:function(t){f=t;var n=Object.keys(f.gender);e.allCategories=n.reduce(function(e,t,n){return e[t]=Object.keys(f.gender[t]),e},{}),e.uniqueCategories={},e.categories=[];for(var r in e.allCategories){e.uniqueCategories[r]=[];for(var o,a,i=0;i<e.allCategories[r].length;i++){o=!1,a=e.allCategories[r][i],e.categories.indexOf(a)<0&&(i<e.categories.length?e.categories.splice(i,0,a):e.categories.push(a));for(var c in e.allCategories)if(r!=c&&e.allCategories[c].indexOf(a)<0){o=!0;break}o&&e.uniqueCategories[r].push(a)}}e.categories.reverse(),p=p||e.randomSchema(!0,1)}}),Object.defineProperty(e,"schema",{get:function(){return g},set:function(t){var n,r=JSON.stringify(t);if(r!=m&&(n=e.schemaToAssets(t))&&(m=r,g=JSON.parse(m),e.categories.forEach(function(e){var t=b.querySelector(".a-editor-"+e);t&&(t.style.backgroundImage=["url(",n[e]?k+n[e]:C,")"].join(""))}),e.allCategories[g.gender].indexOf(h)<0&&Object.keys(e.dependentCategories).indexOf(h)<0&&(h=e.allCategories[g.gender][0],I()),b)){var o=document.createEvent("Events");o.initEvent("onchange",!0,!0),o.avatar=e,b.dispatchEvent(o)}}}),Object.defineProperty(e,"gender",{get:function(){return g.gender},set:function(t){if(t!=g.gender){var n=JSON.parse(m);n.gender=t,e.schema=n,M(),I()}}}),Object.defineProperty(e,"category",{get:function(){return h},set:function(t){t==h||e.allCategories[g.gender].indexOf(t)<0&&Object.keys(e.dependentCategories).indexOf(t)<0||(h=t,I())}}),e.randomSchema=function(t,n){var r={},o={},a=function(e,t,r){var c=i(t,n);return c?(r&&e.length==r.keyIndex&&(o[r.dependet]?c=o[r.dependet]:o[r.dependet]=c),e.push(c),"object"==typeof t[c]?a(e,t[c],r):e):e},c=function(t,o){var c,s=e.data.gender[r.gender];if(s[t]){if(!(c=i(s[t],n)))return;"object"==typeof s[t][c]?r[t]=a([c],s[t][c],o):r[t]=[c]}else r[t]=["none"]};r.gender=i(e.data.gender,n);for(var s,u=0;u<e.categories.length;u++){s=!1;for(var l in e.dependentCategories)if(e.dependentCategories[l].indexOf(e.categories[u])>=0){c(e.categories[u],{keyIndex:1,dependet:l}),s=!0;break}s||c(e.categories[u])}for(var l in e.dependentCategories)r[l]=o[l];return t||(e.schema=r,M(),I()),r},e.schemaToAssets=function(t){var n,r,o,a,i={},c=e.data.gender[t.gender];if(!c)return!1;for(r in t)if(!(e.skipRenderFor.indexOf(r)>=0)&&(n=c[r])){for(var s,u=0;u<t[r].length;u++)if(s=t[r][u],n[s]||""==n[s])n=n[s];else if(n&&"object"==typeof n)n=n[Object.keys(n)[0]];else if("string"!=typeof n||void 0==n)return!1;if("object"==typeof n&&(n=n[[Object.keys(n)[0]]]),"string"!=typeof n)return!1;for(var l in e.dependentCategories)o=q(t.gender,e.dependentCategories[l][0]),a=new RegExp("\\b"+o.join("|")+"\\b"),n=n.replace(a,t[l]);i[r]=n}return i},e.setSchemaProperty=function(t,n){var r=JSON.parse(JSON.stringify(e.schema));for(var o in e.dependentCategories)if(t==o){var a,i,c=q(r.gender,e.dependentCategories[o][0]);for(i in r)for(var a=0;a<r[i].length;a++)c.indexOf(r[i][a])>=0&&(r[i][a]=n[0]||n);break}r[t]=n,e.schema=r},e.detectCategoryByPoint=function(t,n,r,o,a){o=o||e.schema;var i,c,s=0,u=[],l=e.schemaToAssets(o);if(!l)return!1;P||(P=document.createElement("canvas"),T=P.getContext("2d")),P.width=r,P.height=r,T.clearRect(0,0,P.width,P.height);for(i=e.categories.length-1;i>=0;i--){if(c)return;l[e.categories[i]]&&"none"!=l[e.categories[i]]&&function(e,o,i){var l=new Image;u.push(l),l.crossorigin="",l.onload=function(){if(s++,!c){if(T.drawImage(l,0,0,r,r),T.getImageData(t,n,1,1).data[3]>0)return"function"==typeof a&&a("face"===o?"race":o),void(c=!0);s>=u.length&&"function"==typeof a&&a("background")}},l.src=e}(k+l[e.categories[i]],e.categories[i])}},e.drawSchema=function(t,n){t=t||e.schema;var r,o=0,a=[],i=e.schemaToAssets(t);if(!i)return!1;l.save(A+" avatarSchema",t,!0),P||(P=document.createElement("canvas"),T=P.getContext("2d")),P.width=480,P.height=480,T.clearRect(0,0,P.width,P.height);var c=function(e){var t=new Image;a.push(t),t.crossorigin="",t.onload=function(){if(++o>=a.length){for(var e=0;e<a.length;e++)T.drawImage(a[e],0,0);"function"==typeof n&&n(P)}},t.src=e};for(r=0;r<e.categories.length;r++)i[e.categories[r]]&&"none"!=i[e.categories[r]]&&c(k+i[e.categories[r]]),"background"==e.categories[r]&&c(E)},e.getDataUrl=function(t){e.drawSchema(e.schema,function(e){"function"==typeof t&&t(e.toDataURL())})},e.init=function(t,n){n=n||{},A=n.id||A,b=document.querySelector(n.selector||".a-root");var a=b.querySelector(S),i=b.querySelector(".a-download"),u=b.querySelector(".a-more"),d=b.querySelector(".a-logo"),f=b.querySelector(".a-interface-menu"),g=function(t,n){var r=0,o=12*t.length;y.setOptions(t,o),m(n||0),e.schema[e.category]&&e.schema[e.category].length>1&&y.forOptions(function(t){if(e.schema[e.category]&&t.value==e.schema[e.category][1])return r=t.angle,!0}),y.currentAngle=r},m=function(e){var t=12*Math.max(y.count-1,0);y.rotate(e+(180-t/2))},h=function(t){if(t.target.classList.contains("a-button")){switch(t.target.classList.add("interact"),window.setTimeout(function(){t.target.classList.remove("interact")},500),t.target.dataset.action){case"hair":case"eyebrows":case"eyes":case"mouth":case"mustache":case"beard":case"nose":case"ears":case"race":case"clothes":case"background":case"accessories":e.category=t.target.dataset.action;break;case"female":case"male":e.gender=t.target.dataset.action;break;case"random":e.randomSchema();break;case"category":c(S,!0);break;case"download":return;case"save":e.drawSchema(e.schema,function(t){var n=t.toDataURL(),r=b.querySelector(S+"-download"),a=function(){window.onfocus=function(){s("The avatar picture is ready to be used.",b),window.onfocus=void 0}};window.cordova&&window.cordova.base64ToGallery?(r.href="javascript:void(0)",r.removeAttribute("download"),r.onclick=function(){var t=function(){e.saveToAlbum(n,{prefix:"avatar_"}),s("The avatar picture has stored in the album.",b)};if(o&&cordova.plugins&&cordova.plugins.diagnostic){var r=window.cordova.plugins.diagnostic;r.isCameraRollAuthorized(function(e){e?t():r.getCameraRollAuthorizationStatus(function(e){e===r.permissionStatus.NOT_REQUESTED?r.requestCameraRollAuthorization(function(e){e===r.permissionStatus.GRANTED&&t()}):e===r.permissionStatus.DENIED||e===r.permissionStatus.DENIED_ALWAYS?window.navigator.notification.confirm("The Avatar Generator is not authorised to access the photo library. Would you like to switch to the Settings app to allow access?",function(e){1===e&&r.switchToSettings()},"Authorisation",["Yes","No"]):t()})})}else t()}):/edge|msie|trident/i.test(window.navigator.userAgent)?(r.href="javascript:void(0)",r.onclick=function(){window.open("","_blank").document.writeln('<img src="'+n+'" />'),a()}):(r.href=n,r.download="avatar.png",r.target="_blank",r.onclick=function(){/safari/i.test(navigator.userAgent)?a():s("The download will start within second.",b)}),window.setTimeout(function(){c(i,!0)},100)})}if("A"==t.target.nodeName&&t.target.href){if(!window.cordova)return;window.open(t.target.href,"_system")}return t.stopPropagation(),!r&&t.preventDefault(),!1}},P=function(e){var t=e.currentTarget;window.setTimeout(function(){c(t,!1)},i==t?500:100)},T=r?"touchstart":"mousedown";return document.addEventListener(T,h),a.addEventListener(T,P),i.addEventListener(T,P),u.addEventListener("click",P),b.id=A,n.showLogo&&(d.style.display="block"),n.showMenu&&(f.style.display="block"),n.imgSrc&&(O=n.imgSrc||"img/",k=O+"assets/",C=O+"empty.png",E=O+"bg.png"),n.autoDetectCategory&&b.querySelector(".a-editor > ol").addEventListener("click",function(t){e.detectCategoryByPoint(t.offsetX,t.offsetY,t.target.clientWidth,e.schema,function(t){t&&(e.category=t)})}),y.init({onActive:function(t){t&&e.setSchemaProperty(e.category,[e.schema[e.category][0],t.value])},onSet:function(){y.forOptions(function(e){e.element.style.color=e.value})},selector:j(".a-editor-colors"),cssClass:"color",cssPreffix:"a-",audio:O+"option.wav"}),v.init({onActive:function(t){w.currentAngle=t.angle,g(N(e.category,t.value),t.angle);var n=[t.value];e.schema[e.category]&&"string"!=typeof e.schema[e.category]&&e.schema[e.category].length>1&&n.push(e.schema[e.category][1]),e.setSchemaProperty(e.category,n)},selector:j(".a-editor-options"),cssPreffix:"a-",audio:O+"option.wav"}),w.init({onSnap:function(e,t){v.currentAngle=e},onRollback:function(e,t){m(e)},onRotate:function(e){m(e)},selector:j(".a-editor-options"),cssPreffix:"a-"}),e.data=t,e.schema=n.schema||l.load(A+" avatarSchema")||p,M(),I(),e},e.saveToAlbum=function(e){if(window.cordova&&window.cordova.base64ToGallery){var t=function(){window.cordova.base64ToGallery(e,"avatar_",function(){s("Avatar has been saved into album.")},function(){s("Save. Something went wrong.")})};/android/i.test(navigator.userAgent)&&window.cordova.plugins&&window.cordova.plugins.diagnostic?window.cordova.plugins.diagnostic.requestRuntimePermission(function(e){e?t():s("Permission not granted for the requested operation.")},function(){s("Permission. Something went wrong.")},window.cordova.plugins.diagnostic.runtimePermission.WRITE_EXTERNAL_STORAGE):t()}},e.more=function(){c(".a-more",!0)},e},Avatar.contactMe=function(e){var t=["oleksiy.nesterov","+",[].join.apply(["avatar","gmail"],["@"]),".com"].join("");e&&!window.cordova?e.innerHTML=t:window.open("mailto:"+t,window.cordova?"_system":"_blank")},Avatar().init(window.AvatarData,{showLogo:!0,showMenu:!0,autoDetectCategory:!0});
//# sourceMappingURL=avatar.min.js.map
